;WITH NC AS
(
    -- Default behavior: only customers from t_NewT24Customers
    SELECT
        T24C.Id AS NewCustomerId,

        dbo.Fn_NormalizeWord(T24C.DateOfBirth)   AS DateOfBirth,
        dbo.Fn_NormalizeWord(T24C.GivenNames)    AS GivenNames,
        dbo.Fn_NormalizeWord(T24C.FamilyName)    AS FamilyName,
        dbo.Fn_NormalizeWord(T24C.FatherName)    AS FatherName,
        dbo.Fn_NormalizeWord(T24C.MoFirstName)   AS MoFirstName,
        dbo.Fn_NormalizeWord(T24C.BirthRegister) AS BirthRegisterId,
        dbo.Fn_NormalizeWord(T24C.BirthRegNo)    AS BirthRegNo,
        dbo.Fn_NormalizeWord(T24C.Gender)        AS Gender,

        SOUNDEX(CONVERT(nvarchar(200), LEFT(dbo.Fn_NormalizeWord(T24C.GivenNames), 200)))   AS Sdx_GivenNames,
        SOUNDEX(CONVERT(nvarchar(200), LEFT(dbo.Fn_NormalizeWord(T24C.FamilyName), 200)))   AS Sdx_FamilyName,
        SOUNDEX(CONVERT(nvarchar(200), LEFT(dbo.Fn_NormalizeWord(T24C.FatherName), 200)))   AS Sdx_FatherName,
        SOUNDEX(CONVERT(nvarchar(200), LEFT(dbo.Fn_NormalizeWord(T24C.MoFirstName), 200)))  AS Sdx_MoFirstName
    FROM dbo.t_NewT24Customers AS NT24C
    JOIN dbo.t_T24Customer     AS T24C ON NT24C.CustomerId = T24C.Id
    WHERE
        @CustomerId IS NULL
        AND NT24C.StatusCode = @StatusCode

    UNION ALL

    -- Optional behavior: direct pick from t_T24Customer (ignores t_NewT24Customers)
    SELECT
        T24C.Id AS NewCustomerId,

        dbo.Fn_NormalizeWord(T24C.DateOfBirth)   AS DateOfBirth,
        dbo.Fn_NormalizeWord(T24C.GivenNames)    AS GivenNames,
        dbo.Fn_NormalizeWord(T24C.FamilyName)    AS FamilyName,
        dbo.Fn_NormalizeWord(T24C.FatherName)    AS FatherName,
        dbo.Fn_NormalizeWord(T24C.MoFirstName)   AS MoFirstName,
        dbo.Fn_NormalizeWord(T24C.BirthRegister) AS BirthRegisterId,
        dbo.Fn_NormalizeWord(T24C.BirthRegNo)    AS BirthRegNo,
        dbo.Fn_NormalizeWord(T24C.Gender)        AS Gender,

        SOUNDEX(CONVERT(nvarchar(200), LEFT(dbo.Fn_NormalizeWord(T24C.GivenNames), 200)))   AS Sdx_GivenNames,
        SOUNDEX(CONVERT(nvarchar(200), LEFT(dbo.Fn_NormalizeWord(T24C.FamilyName), 200)))   AS Sdx_FamilyName,
        SOUNDEX(CONVERT(nvarchar(200), LEFT(dbo.Fn_NormalizeWord(T24C.FatherName), 200)))   AS Sdx_FatherName,
        SOUNDEX(CONVERT(nvarchar(200), LEFT(dbo.Fn_NormalizeWord(T24C.MoFirstName), 200)))  AS Sdx_MoFirstName
    FROM dbo.t_T24Customer AS T24C
    WHERE
        @CustomerId IS NOT NULL
        AND T24C.Id = @CustomerId
)
