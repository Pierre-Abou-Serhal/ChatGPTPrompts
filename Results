USE [Alterna_KYC]
GO
/****** Object:  UserDefinedFunction [dbo].[Fn_NormalizeWord]    Script Date: 12/22/2025 9:19:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER   FUNCTION [dbo].[Fn_NormalizeWord](@s NVARCHAR(4000))
RETURNS NVARCHAR(4000)
AS
BEGIN
    IF @s IS NULL RETURN NULL;

    -- Turn non-breaking spaces into normal spaces
    SET @s = REPLACE(@s, NCHAR(160), N' ');

    -- Trim
    SET @s = LTRIM(RTRIM(@s));

    -- Replace tabs / line breaks with spaces
    SET @s = REPLACE(@s, CHAR(9),  N' ');
    SET @s = REPLACE(@s, CHAR(10), N' ');
    SET @s = REPLACE(@s, CHAR(13), N' ');

    -- Collapse multiple spaces to a single space
    WHILE CHARINDEX(N'  ', @s) > 0
        SET @s = REPLACE(@s, N'  ', N' ');

    -- unify case
    SET @s = UPPER(@s);

    RETURN NULLIF(@s, N'');
END
