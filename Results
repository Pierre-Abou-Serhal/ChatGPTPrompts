const fs = require("fs");

const hexString = `0xFFD8FFE0...E0AF-0CDA...`; // your input

// 1) Remove 0x prefix
// 2) Remove anything that isn't a hex digit (this removes "-", spaces, newlines, etc.)
const cleanHex = hexString
  .replace(/^0x/i, "")
  .replace(/[^0-9a-f]/gi, "");

if (cleanHex.length === 0) throw new Error("No valid hex data after cleaning.");
if (cleanHex.length % 2 !== 0) throw new Error("Hex length is odd (must be even).");

const buf = Buffer.from(cleanHex, "hex");

// Debug: check signature
console.log("First 8 bytes:", buf.subarray(0, 8).toString("hex")); // should start ffd8ffe0 for JPEG
const base64String = buf.toString("base64");
console.log("Base64 prefix:", base64String.slice(0, 20)); // JPEG typically starts with /9j/

fs.writeFileSync("../output/base64_text/base64.txt", base64String);
fs.writeFileSync("../output/image.jpg", buf); // optional: write the actual image
console.log("Success");
