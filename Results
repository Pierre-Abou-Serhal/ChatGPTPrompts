SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [dbo].[usp_Sync_Dictionary_Bulk] 
	@P__Dictionary TVP_Dictionary READONLY,
    @P__User NVARCHAR(250)
AS
BEGIN

	MERGE INTO t_Dictionary AS Target
	USING (SELECT DISTINCT * FROM @P__Dictionary) AS Source
	ON Target.AlternativeAccountId = Source.AlternativeAccountId AND Target.FileId = Source.FileId
	WHEN MATCHED THEN
		UPDATE 
		 SET Target.T24AccountId = Source.T24AccountId,
			Target.LastModifiedBy = @P__User,
			Target.LastModifiedDate = GETDATE()
	WHEN NOT MATCHED THEN
		INSERT 
			(
				[AlternativeAccountId],
				[T24AccountId],
				[ProductCode],
				[FileId],
				[CreatedBy],
				[LastModifiedBy]
			)
		VALUES
			(
				Source.AlternativeAccountId,
				Source.T24AccountId,
				Source.ProductCode,
				Source.FileId,
				@P__User,
				@P__User
			);
END

GO
